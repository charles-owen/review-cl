"use strict";(self.webpackChunkcse335=self.webpackChunkcse335||[]).push([[306],{43201:(e,t,i)=>{i(28878);var s=i(66759),r={class:"content"},n={class:"full cl-reviewing"},a={key:0},o={class:"center"},u=(0,s._)("button",{type:"submit"},"Assign Reviews",-1),l=["value"],c={class:"small"},v=(0,s._)("th",null,"Name",-1),w=(0,s._)("th",null,"User ID",-1),f={class:"small"};const m={extends:Site.Site.ConsoleComponentBase,props:["assigntag","statusUser","count"]};var h=i(87619);const g=(0,h.Z)(m,[["render",function(e,t,i,r,n,a){var o=(0,s.up)("router-link");return null!==i.statusUser?((0,s.wg)(),(0,s.j4)(o,{key:0,to:e.root+"/cl/console/grading/"+i.assigntag+"/"+i.statusUser.member.id,title:i.statusUser.name},{default:(0,s.w5)((function(){return[(0,s.Uk)((0,s.zw)(i.statusUser.userId)+"/"+(0,s.zw)(i.count),1)]})),_:1},8,["to","title"])):(0,s.kq)("v-if",!0)}]]);function d(e,t){var i="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!i){if(Array.isArray(e)||(i=function(e,t){if(!e)return;if("string"==typeof e)return p(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);"Object"===i&&e.constructor&&(i=e.constructor.name);if("Map"===i||"Set"===i)return Array.from(e);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return p(e,t)}(e))||t&&e&&"number"==typeof e.length){i&&(e=i);var s=0,r=function(){};return{s:r,n:function(){return s>=e.length?{done:!0}:{done:!1,value:e[s++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,a=!0,o=!1;return{s:function(){i=i.call(e)},n:function(){var e=i.next();return a=e.done,e},e:function(e){o=!0,n=e},f:function(){try{a||null==i.return||i.return()}finally{if(o)throw n}}}}function p(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,s=new Array(t);i<t;i++)s[i]=e[i];return s}const b={extends:Site.Site.ConsoleComponentBase,props:["assigntag"],data:function(){return{assignment:null,reviewerCnt:2,instructor:Site.Member.INSTRUCTOR,reviewers:null,reviewees:null,maxReviewees:0,maxReviewers:0}},components:{membersfetcher:Site.MembersFetcherComponentVue,"status-present":g},mounted:function(){var e=this,t=this.$store.state.user.user.member;this.section=this.$store.getters["course/section"](t.semester,t.section),this.assignment=this.section.getAssignment(this.assigntag),this.setTitle(": "+this.assignment.shortname+" Reviewing"),this.$site.api.get("/api/review/reviewers/"+this.assigntag,{}).then((function(t){t.hasError()?e.$site.toast(e,t):e.take(t)})).catch((function(t){e.$site.toast(e,t)}))},methods:{assignReviews:function(){var e=this;this.maxReviewees>0||this.maxReviewers>0?new this.$site.Dialog.MessageBox("Are you sure?","Are you sure you want to assign reviewers? This will replace the existing reviewing assignments.",this.$site.Dialog.MessageBox.OKCANCEL,(function(){e.assignReviewsActual()})):this.assignReviewsActual()},assignReviewsActual:function(){var e=this;this.reviewers=null,this.reviewees=null,this.maxReviewees=0,this.maxReviewers=0;var t={cnt:this.reviewerCnt};this.$site.api.post("/api/review/reviewers/"+this.assigntag,t).then((function(t){t.hasError()?e.$site.toast(e,t):e.take(t)})).catch((function(t){e.$site.toast(e,t)}))},take:function(e){var t=e.getData("reviewers").attributes;this.reviewers={},this.reviewees={},this.maxReviewees=0,this.maxReviewers=0;var i,s=d(t);try{for(s.s();!(i=s.n()).done;){var r=i.value,n=+r[0],a=+r[1],o=+r[2];void 0===this.reviewers[n]&&(this.reviewers[n]=[]),this.reviewers[n].push([a,o]),this.reviewers[n].length>this.maxReviewees&&(this.maxReviewees=this.reviewers[n].length),void 0===this.reviewees[a]&&(this.reviewees[a]=[]),this.reviewees[a].push([n,o]),this.reviewees[a].length>this.maxReviewers&&(this.maxReviewers=this.reviewers[n].length)}}catch(e){s.e(e)}finally{s.f()}},displayUser:function(e,t,i){if(void 0===t||i>=t.length)return null;var s,r=d(e);try{for(r.s();!(s=r.n()).done;){var n=s.value;if(n.member.id===t[i][0])return n}}catch(e){r.e(e)}finally{r.f()}return null},cls:function(e,t){return void 0===e||t>=e.length?"":e[t][1]<1?"cl-empty":""}}},y=(0,h.Z)(b,[["render",function(e,t,i,m,h,g){var d=(0,s.up)("router-link"),p=(0,s.up)("status-present"),b=(0,s.up)("membersfetcher");return(0,s.wg)(),(0,s.iD)("div",r,[(0,s._)("div",n,[(0,s.Wm)(b,{fetching:null===e.reviewers},{default:(0,s.w5)((function(r){return[e.user.atLeast(e.instructor)?((0,s.wg)(),(0,s.iD)("div",a,[(0,s._)("form",{method:"post",onSubmit:t[1]||(t[1]=(0,s.iM)((function(){return g.assignReviews&&g.assignReviews.apply(g,arguments)}),["prevent"]))},[(0,s._)("p",o,[u,(0,s.wy)((0,s._)("select",{"onUpdate:modelValue":t[0]||(t[0]=function(t){return e.reviewerCnt=t})},[((0,s.wg)(),(0,s.iD)(s.HY,null,(0,s.Ko)(6,(function(e){return(0,s._)("option",{value:e},(0,s.zw)(e),9,l)})),64))],512),[[s.bM,e.reviewerCnt]])])],32)])):(0,s.kq)("v-if",!0),(0,s._)("table",c,[(0,s._)("tr",null,[v,w,((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(e.maxReviewees,(function(e){return(0,s.wg)(),(0,s.iD)("th",null,"reviewee")})),256)),((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(e.maxReviewers,(function(e){return(0,s.wg)(),(0,s.iD)("th",null,"reviewer")})),256))]),((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(r.users,(function(t){return(0,s.wg)(),(0,s.iD)("tr",null,[(0,s._)("td",f,[(0,s.Wm)(d,{title:t.name,to:e.root+"/cl/console/grading/"+i.assigntag+"/"+t.member.id},{default:(0,s.w5)((function(){return[(0,s.Uk)((0,s.zw)(t.name),1)]})),_:2},1032,["title","to"])]),(0,s._)("td",null,[(0,s.Wm)(d,{title:t.name,to:e.root+"/cl/console/grading/"+i.assigntag+"/"+t.member.id},{default:(0,s.w5)((function(){return[(0,s.Uk)((0,s.zw)(t.userId),1)]})),_:2},1032,["title","to"])]),((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(e.maxReviewees,(function(n){return(0,s.wg)(),(0,s.iD)("td",{class:(0,s.C_)(g.cls(e.reviewers[t.member.id],n-1))},[(0,s.Wm)(p,{assigntag:i.assigntag,"status-user":g.displayUser(r.users,e.reviewers[t.member.id],n-1),count:void 0!==e.reviewers[t.member.id]?e.reviewers[t.member.id][n-1][1]:0},null,8,["assigntag","status-user","count"])],2)})),256)),((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(e.maxReviewers,(function(n){return(0,s.wg)(),(0,s.iD)("td",{class:(0,s.C_)(g.cls(e.reviewees[t.member.id],n-1))},[(0,s.Wm)(p,{assigntag:i.assigntag,"status-user":g.displayUser(r.users,e.reviewees[t.member.id],n-1),count:void 0!==e.reviewees[t.member.id]?e.reviewees[t.member.id][n-1][1]:0},null,8,["assigntag","status-user","count"])],2)})),256))])})),256))])]})),_:1},8,["fetching"])])])}]]);var R={class:"cl-reviews"},S=(0,s._)("h2",null,"Staff Review",-1),_={ref:"editor"},k=(0,s._)("p",null,[(0,s._)("input",{type:"submit",value:"Submit Review"})],-1),x=(0,s._)("h3",null,"Reviews by this user.",-1),D={key:0,class:"center"},A={class:"cl-review"},C={class:"cl-submitted"},U={class:"cl-review-present"},$=(0,s._)("h3",null,"Reviews of this user's assignment.",-1),z={key:1,class:"center"},T={class:"cl-review"},I={key:0},M={key:1},E={class:"cl-submitted"},K={class:"cl-review-present"};function Y(e,t){var i="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!i){if(Array.isArray(e)||(i=function(e,t){if(!e)return;if("string"==typeof e)return H(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);"Object"===i&&e.constructor&&(i=e.constructor.name);if("Map"===i||"Set"===i)return Array.from(e);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return H(e,t)}(e))||t&&e&&"number"==typeof e.length){i&&(e=i);var s=0,r=function(){};return{s:r,n:function(){return s>=e.length?{done:!0}:{done:!1,value:e[s++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,a=!0,o=!1;return{s:function(){i=i.call(e)},n:function(){var e=i.next();return a=e.done,e},e:function(e){o=!0,n=e},f:function(){try{a||null==i.return||i.return()}finally{if(o)throw n}}}}function H(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,s=new Array(t);i<t;i++)s[i]=e[i];return s}const O={props:["user","assigntag"],data:function(){return{forReviews:[],byReviews:[],staffRole:Site.Site.Member.STAFF,submissions:[]}},watch:{user:function(){this.forReviews=[],this.byReviews=[],this.submissions=[],this.fetch()}},mounted:function(){var e=this.$refs.editor;this.editor=new this.$site.Editor(e,{height:"10em",classes:["yellow-pad"]}),this.fetch()},methods:{fetch:function(){var e=this;this.$site.api.get("/api/review/reviews/"+this.assigntag+"/"+this.user.member.id,{}).then((function(t){t.hasError()?e.$site.toast(e,t):e.take(t)})).catch((function(t){e.$site.toast(e,t)}))},take:function(e){var t=e.getData("reviews-by-for").attributes,i=e.getData("assignment-submissions");null!==i&&(this.submissions=i.attributes);var s,r=Y(t.for);try{for(r.s();!(s=r.n()).done;){var n=s.value;n.reviewer=new Site.User(n.reviewer)}}catch(e){r.e(e)}finally{r.f()}var a,o=Y(t.by);try{for(o.s();!(a=o.n()).done;){var u=a.value;u.reviewee=new Site.User(u.reviewee)}}catch(e){o.e(e)}finally{o.f()}this.forReviews=t.for,this.byReviews=t.by},submit:function(){var e=this,t=this.editor.textarea.value.trim();if(""!==t){var i={};for(var s in this.submissions)i[s]={id:this.submissions[s][0].id,date:this.submissions[s][0].date};var r={type:"text/plain",text:t,submissions:i};Site.api.post("/api/review/staffreview/".concat(this.assigntag,"/").concat(this.user.member.id),r).then((function(t){t.hasError()?Site.toast(e,t):(e.editor.textarea.value="",e.take(t),Site.toast(e,"Review successfully saved to the server"))})).catch((function(t){Site.toast(e,t)}))}else Site.toast(this,"You must enter some text to submit")},formatTime:function(e){return this.$site.TimeFormatter.relativeUNIX(e,null)},showSubmissions:function(e){var t=e.meta.review.submissions,i="";for(var s in t)i+=this.$site.TimeFormatter.absoluteUNIX(t[s].date);return""===i?"":"Submission: "+i}}},Z=(0,h.Z)(O,[["render",function(e,t,i,r,n,a){return(0,s.wg)(),(0,s.iD)("div",R,[S,(0,s._)("form",{method:"post",onSubmit:t[0]||(t[0]=(0,s.iM)((function(){return a.submit&&a.submit.apply(a,arguments)}),["prevent"]))},[(0,s._)("div",_,null,512),k],32),x,0===e.byReviews.length?((0,s.wg)(),(0,s.iD)("p",D,"None")):(0,s.kq)("v-if",!0),((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(e.byReviews,(function(t){return(0,s.wg)(),(0,s.iD)("div",A,[(0,s._)("h3",{class:(0,s.C_)(t.reviewee.atLeast(e.staffRole)?"staff":"")},[(0,s.Uk)((0,s.zw)(a.formatTime(t.time))+" Review by "+(0,s.zw)(t.reviewee.name)+" ",1),(0,s._)("span",C,(0,s.zw)(a.showSubmissions(t)),1)],2),(0,s._)("div",U,(0,s.zw)(t.meta.review.review),1)])})),256)),$,0===e.forReviews.length?((0,s.wg)(),(0,s.iD)("p",z,"None")):(0,s.kq)("v-if",!0),((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(e.forReviews,(function(t){return(0,s.wg)(),(0,s.iD)("div",T,[(0,s._)("h3",{class:(0,s.C_)(t.reviewer.atLeast(e.staffRole)?"staff":"")},[(0,s.Uk)((0,s.zw)(a.formatTime(t.time))+" ",1),t.reviewer.atLeast(e.staffRole)?((0,s.wg)(),(0,s.iD)("span",I,"Staff Review")):((0,s.wg)(),(0,s.iD)("span",M,"Review")),(0,s.Uk)(" by "+(0,s.zw)(t.reviewer.name)+" ",1),(0,s._)("span",E,(0,s.zw)(a.showSubmissions(t)),1)],2),(0,s._)("div",K,(0,s.zw)(t.meta.review.review),1)])})),256))])}]]);var j=function(){};j.setup=function(e){e.Review={reviewsbyfor:Z},e.tables.add({title:"Review",order:70,api:"/api/review/tables"}),e.components.addRoute({route:"/review/reviewers/:assigntag",component:y,props:!0}),e.course.assignmentLink("review","reviewers","/review/reviewers/:assigntag")},Site.Console&&!Site.Console.Review&&j.setup(Site.Console)},69528:(e,t,i)=>{i.d(t,{Z:()=>o});var s=i(47289),r=i.n(s),n=i(38306),a=i.n(n)()(r());a.push([e.id,"div.cl-reviewing td.cl-empty{background-color:#e8f7f3}p.cl-reviews-none{text-align:center;color:#00723f;font-style:italic}div.cl-reviews h3{text-align:center;background:#00723f;color:#fff}div.cl-review{margin:1em 0}div.cl-review h3{font-size:.85em;font-style:italic;font-weight:normal;background:rgba(0,0,0,0);color:#00723f;border-bottom:1px solid #00723f;text-align:left}div.cl-review h3 span.cl-submitted{float:right;color:#00909e;font-size:.9em}div.cl-review h3.staff{color:red}div.cl-review pre{margin:0;white-space:pre-wrap}div.cl-review div.cl-review-present{margin:0;white-space:pre-wrap}",""]);const o=a},28878:(e,t,i)=>{var s=i(54571),r=i.n(s),n=i(50063),a=i.n(n),o=i(14971),u=i.n(o),l=i(78446),c=i.n(l),v=i(71984),w=i.n(v),f=i(63641),m=i.n(f),h=i(69528),g={};g.styleTagTransform=m(),g.setAttributes=c(),g.insert=u().bind(null,"head"),g.domAPI=a(),g.insertStyleElement=w();r()(h.Z,g),h.Z&&h.Z.locals&&h.Z.locals}},e=>{e.O(0,[736,828,77,530,592],(()=>{return t=43201,e(e.s=t);var t}));e.O()}]);